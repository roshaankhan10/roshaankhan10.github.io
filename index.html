<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CSV Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select { padding: 5px; font-size: 16px; }
    input { padding: 5px; margin-left: 10px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #f2f2f2; cursor: pointer; }
    tr:nth-child(even) { background: #fafafa; }
  </style>
</head>
<body>

<h1>CSV Viewer</h1>

<label for="csvSelect">Choose a CSV file:</label>
<select id="csvSelect">
  <option value="">-- Loading CSV files... --</option>
</select>

<input type="text" id="searchInput" placeholder="Search table..." />

<div id="csvTable"></div>

<script>
const username = "YOUR_USERNAME"; // <-- change this
const repo = "YOUR_REPO"; // <-- change this
const branch = "main"; // change if using another branch

async function listCSVFiles() {
  const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/`;
  const response = await fetch(apiUrl);
  const files = await response.json();

  const csvFiles = files.filter(f => f.name.toLowerCase().endsWith(".csv"));
  const select = document.getElementById("csvSelect");

  select.innerHTML = `<option value="">-- Select a file --</option>`;
  csvFiles.forEach(file => {
    const option = document.createElement("option");
    option.value = file.download_url;
    option.textContent = file.name;
    select.appendChild(option);
  });
}

async function loadCSV(url) {
  const response = await fetch(url);
  const text = await response.text();
  const rows = text.trim().split("\n").map(row => row.split(","));

  let html = "<table><thead><tr>";
  rows[0].forEach(header => { html += `<th>${header}</th>`; });
  html += "</tr></thead><tbody>";

  rows.slice(1).forEach(row => {
    html += "<tr>" + row.map(cell => `<td>${cell}</td>`).join("") + "</tr>";
  });
  html += "</tbody></table>";

  document.getElementById("csvTable").innerHTML = html;

  makeTableSortable();
}

function makeTableSortable() {
  const table = document.querySelector("table");
  const headers = table.querySelectorAll("th");

  headers.forEach((header, index) => {
    header.addEventListener("click", () => {
      const rows = Array.from(table.querySelectorAll("tbody tr"));
      const asc = header.classList.toggle("asc");

      rows.sort((a, b) => {
        const cellA = a.children[index].innerText;
        const cellB = b.children[index].innerText;
        return asc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
      });

      rows.forEach(row => table.querySelector("tbody").appendChild(row));
    });
  });
}

document.getElementById("csvSelect").addEventListener("change", function() {
  if (this.value) loadCSV(this.value);
  else document.getElementById("csvTable").innerHTML = "";
});

document.getElementById("searchInput").addEventListener("input", function() {
  const filter = this.value.toLowerCase();
  document.querySelectorAll("tbody tr").forEach(row => {
    row.style.display = Array.from(row.children)
      .some(td => td.innerText.toLowerCase().includes(filter)) ? "" : "none";
  });
});

listCSVFiles();
</script>

</body>
</html>
